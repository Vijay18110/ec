import{b as a,c as I,A as T,K as w,a as R,y as S,u as F,j as e,m as D,e as U,k as q,L as E,d as W}from"./index-CQ0pFaA9.js";import{U as J,p as B,P as H,u as O,V as C,X as z,M as G}from"./App-9vCfEsS0.js";import{p as Q}from"./pdf-DFLGUOfR.js";import{a as V}from"./CheckFileValidation-BeJluwVf.js";import{d as _}from"./index-CVwLQDY8.js";import{P as $}from"./ProductNotFound-CgC6xYK4.js";function K(r){const[h,b]=a.useState([]),[l,j]=a.useState(!0),[f,n]=a.useState(null);return I(),a.useEffect(()=>{(async()=>{try{const o=JSON.parse(sessionStorage.getItem("loggedInUser"));if(o){const N={Fk_CustomerId:o.CustomerId,LoginToken:o.LoginToken,AppVersion:"1.0",DeviceType:"Web",value:3,flag:"ddlSupportType"},k={Body:await T.encryptString(w,JSON.stringify(N))},v=await R.post("/DropDownData",k),g=await T.decryptString(w,v.data.body),p=JSON.parse(g);p.Status||b(p.Response.dropDownData),p.Status===3&&S.error("Login Token Expire !",{toastId:"dsfkjsdfhsfjsdhfsd"}),p.Status===1&&S.error(p.Message)}}catch(o){console.log(o),n(o)}finally{j(!1)}})()},[r]),{dropData:h,loading:l,error:f}}function X(r){return!r.SupportTypeId||r.SupportTypeId.trim()===""||r.SupportTypeId==="--Select Support Type--"?(S.error("Support Type is required."),!1):!r.Subject||r.Subject.trim()===""?(S.error("Subject is required."),!1):["High","Medium","Low"].includes(r.Priority)?!0:(S.error("Priority must be High, Medium, or Low."),!1)}const Y=({setIsHelpping:r})=>{const{dropData:h,loading:b}=K(),[l,j]=a.useState([]),f=I(),[n,i]=a.useState({SupportForId:"",SupportTypeId:"",Subject:"",Query:"",Priority:"High"}),o=()=>{var t;return(l==null?void 0:l.length)===0?null:(t=Array==null?void 0:Array.from(l))==null?void 0:t.map((s,u)=>e.jsxs("div",{style:{display:"inline-block",position:"relative"},children:[e.jsx("span",{className:"bg-danger px-2",style:{position:"absolute",right:"0%",top:"0%"},onClick:()=>N(u),children:"X"}),s.type.startsWith("image/")?e.jsx(H,{imgurl:s}):s.type==="application/pdf"?e.jsx("a",{href:URL.createObjectURL(s),target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:Q,alt:"PDF preview",width:"100",className:"imgPreview",style:{aspectRatio:"1/1",objectFit:"contain",background:"#f5f5f5",padding:"10px",borderRadius:6}})}):e.jsx("p",{style:{fontSize:"12px"},children:"Unsupported file"})]},u))},N=t=>{const s=Array.from(l).filter((u,d)=>d!==t);j(s)},x=t=>{const{name:s,value:u,files:d}=t.target;d&&Array.from(d).some(y=>!V(y))||i({...n,[s]:d?j(d):u,Combfilename:""})},k=t=>{i({...n,Priority:t})},[v,g]=a.useState(!1),p=async t=>{t.preventDefault();try{if(g(!0),X(n)){const s=JSON.parse(sessionStorage.getItem("loggedInUser")),u={LoginToken:s.LoginToken,AutoId:s.CustomerId,DeviceType:"Web",AppVersion:"1.0",Combfilename:"",...n},d=new FormData;l.length>0&&Array.from(l).forEach(M=>d.append("File",M));const y=await T.encryptString(w,JSON.stringify(u));d.append("Body",y);const A=await R.post("/CreateSupportTicket",d,{headers:{"Content-Type":"multipart/form-data"}}),P=await T.decryptString(w,A.data.body),L=JSON.parse(P);L.Status===0?(S.success("Ticket submitted successfully!"),i({Priority:"High",Query:"",Subject:"",SupportForId:"",SupportTypeId:""}),j(null),r(!1),f(q.setIsOpenSupportTicketForm(!1))):S.error(L.Message||"Error submitting ticket")}}catch(s){console.log(s)}finally{g(!1)}},c=F(),m=()=>{f(U.settabs("SupportTicketList")),c("/my-profile"),r(!1)};return e.jsxs("div",{className:"my-4",children:[e.jsxs("div",{className:"d-flex backcontainer justify-content-between",children:[e.jsx("h4",{className:"mb-3",children:"Support Ticket"}),e.jsx("i",{style:{height:"30px",width:"30px"},className:"d-d-inline-block",onClick:m,children:e.jsx(J,{size:20})})]}),e.jsx("div",{className:"card p-4",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("img",{style:{maxWidth:"150px"},loading:"lazy",src:B,alt:"Support",className:"mb-3 "}),e.jsx("h3",{className:"fw-bold",children:"Help is Just a Click Away!"}),e.jsx("p",{className:"text-muted",children:"Weâ€™ll try to fix it faster than your morning coffee kicks in!"})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Support Type *"}),e.jsx("select",{className:"form-select",name:"SupportTypeId",value:n.SupportTypeId,onChange:x,children:b?e.jsx("option",{value:"",children:"loading..."}):h.map(t=>e.jsx("option",{value:t.Id,children:t.Name},t.Id))})]})}),e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Subject *"}),e.jsx("input",{type:"text",className:"form-control",name:"Subject",value:n.Subject,onChange:x,placeholder:"Give your ticket a title - make it catchy!",autoComplete:"off"})]})}),e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Query"}),e.jsx("textarea",{className:"form-control",name:"Query",value:n.Query,onChange:x,rows:"4"})]})}),e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label me-3",children:"Priority *"}),e.jsx("div",{className:"btn-group",role:"group",children:["Low","Medium","High"].map(t=>e.jsxs("div",{className:"priority-switch-group",role:"group",children:[e.jsx("input",{type:"radio",onChange:()=>k(t),checked:n.Priority===t,id:t,name:t}),e.jsx("label",{htmlFor:t,className:`switch ${t}`,children:t.charAt(0).toUpperCase()+t.slice(1)})]}))})]})}),e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"Combfilename",children:"Attachment"}),e.jsxs("label",{htmlFor:"Combfilename",className:"p-2 rounded mb-0 viewcartbutton d-flex justify-content-center align-items-center mt-2",style:{height:"100%",maxWidth:"100%",display:"block"},children:[e.jsx("i",{children:e.jsx(_,{size:"20"})}),"Upload File",e.jsx("input",{id:"Combfilename",type:"file",name:"file",multiple:!0,hidden:!0,onChange:x})]}),e.jsx("div",{className:" pt-1 ",children:e.jsx("div",{className:"d-flex flex-wrap  align-items-center column-gap-1 w-100",children:o()})})]})}),e.jsx("div",{className:"col-lg-6 mt-3",children:e.jsx("button",{type:"submit",onClick:p,className:" p-2 rounded viewcartbutton mt-3 w-100 fw-bold",children:"Raise My Ticket!"})})]}),v&&e.jsx(D,{})]})})})]})},Z="/assets/need-support1-rZqWCgpJ.png",ee="/assets/pending.icon-BgVq_mym.png",se=({handleCloseModal:r,ticketNo:h,RefetchSupportTicketDetails:b,setUpdatedCardId:l})=>{const{loading:j,sendApiRequest:f}=O(),[n,i]=a.useState(h&&h),[o,N]=a.useState(0),[x,k]=a.useState(""),v=c=>{N(c)},g=async()=>{if(!o){S.error("Please Rate First!",{toastId:"rate"});return}const c=await JSON.parse(sessionStorage.getItem("loggedInUser")),m={TicketNo:n,RatingNumber:o,Feedback:x,AutoId:c.CustomerId,LoginToken:c.LoginToken,DeviceType:"Web"};await f("POST","/SaveSupportTicketfeedBack",m),r(),b(),l(h)},p=[1,2,3,4,5];return e.jsxs("div",{className:"rate",children:[e.jsx("h4",{children:"How did we do?"}),e.jsx("div",{className:"my-2",children:p.map((c,m)=>e.jsx(E,{onClick:()=>v(c),children:e.jsx(C,{size:25,color:o>m?"gold":""})},m))}),e.jsx("textarea",{onInput:c=>k(c.target.value),cols:"40",rows:"5",placeholder:"Anything to say?","aria-required":"true"}),e.jsx("button",{onClick:g,type:"submit",className:"btn  btn-outline-secondary",children:j?"Sending..":"Send your rating"})]})},le=()=>{var t;const[r,h]=a.useState(!1),[b,l]=a.useState(""),[j,f]=a.useState(),{loading:n,response:i,sendApiRequest:o}=O(),[N,x]=a.useState(!1);I();const k=W(s=>s.chatreducer.isOpenSupportTicketForm),v=F(),g=()=>{const s=JSON.parse(sessionStorage.getItem("loggedInUser"));s&&o("POST","/GetSupportTicketList",{FkCustomerId:s==null?void 0:s.CustomerId,PAGESIZE:"",PAGENO:"",bigintCreatedBy:s==null?void 0:s.CustomerId,Status:"",DeviceType:"Web",AppVersion:"1.0",LoginToken:s==null?void 0:s.LoginToken})};a.useEffect(()=>{g()},[k]);const p=s=>{v(`/chat?id=${s}`)},c=a.useCallback(s=>{l(s),h(u=>!u)},[]),m=[1,2,3,4,5];return e.jsx(e.Fragment,{children:N?e.jsx(Y,{setIsHelpping:x}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mt-5",children:[e.jsx("div",{className:"mb-3 d-flex justify-content-end",children:e.jsx(z,{click:()=>x(!0),children:"Create new ticket"})}),(i==null?void 0:i.SupportTicketListData.length)>0?(t=i==null?void 0:i.SupportTicketListData)==null?void 0:t.map((s,u)=>e.jsxs("div",{className:"support-list",children:[(s==null?void 0:s.Status)==="Opened"?e.jsxs("div",{className:"status1",children:[e.jsx("span",{children:"Status: Opened"}),e.jsx("p",{style:{color:"#597545"},children:"Your support request has met its happy ending."})]}):e.jsxs("div",{className:"status",children:[e.jsx("span",{children:"Status: Closed"}),e.jsx("p",{style:{color:"#da1204cc"},children:"Your support request has met its happy ending."})]}),e.jsxs("div",{className:"status-box",children:[e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Support Ticket ID :"}),e.jsxs("span",{className:" fw-bold",onClick:()=>p(s==null?void 0:s.TicketNo),style:{cursor:"pointer",color:"#597545"},children:["#",s==null?void 0:s.TicketNo]})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Subject :"}),e.jsx("span",{children:s==null?void 0:s.Subject})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Type : "}),e.jsx("span",{children:s==null?void 0:s.SupportType})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Created On:"}),e.jsx("span",{children:s==null?void 0:s.CreatedOn})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Last Reply:"}),e.jsx("span",{children:s==null?void 0:s.LastUpdated})]}),(s==null?void 0:s.feedback)&&e.jsxs("li",{children:[e.jsx("strong",{children:"Feedback:"})," ",e.jsxs("span",{style:{color:"#597545",fontWeight:"500",maxWidth:"600px"},children:[s==null?void 0:s.feedback,"     "]})]})]}),e.jsxs("div",{class:"need-support",children:[(s==null?void 0:s.Status)==="Opened"?e.jsx("img",{src:Z,alt:""}):e.jsx("img",{src:ee,className:"img1",alt:""}),(s==null?void 0:s.Status)!=="Opened"&&!(s!=null&&s.starRating)?e.jsxs("div",{onClick:()=>c(s.TicketNo),class:"rate5",children:[e.jsx("strong",{children:"   Need Support "}),e.jsx("span",{className:"my-3",children:"Rate Us"})]}):(s==null?void 0:s.Status)!=="Opened"&&e.jsx("p",{className:` d-flex align-items-center justify-content-center flex-wrap\r
                    `,children:e.jsx("span",{children:m.map((d,y)=>d<=Number(s==null?void 0:s.starRating)?e.jsx(C,{style:(s==null?void 0:s.starRating)>y?{color:"gold"}:{color:"black"}},y):e.jsx(C,{style:(s==null?void 0:s.starRating)>y?{color:"gold"}:{color:"black"}},y))})})]})]})]},u)):e.jsx($,{vh:!0,altText:"Friendly product-not-found illustration"}),n&&e.jsx(D,{})]}),r&&e.jsx(G,{handleCloseModal:c,children:e.jsx(se,{setUpdatedCardId:f,ticketNo:b,handleCloseModal:c,RefetchSupportTicketDetails:g})})]})})};export{le as default};
