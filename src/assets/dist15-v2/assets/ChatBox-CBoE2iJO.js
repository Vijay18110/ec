import{j as e,b as a,l as U,L as F,S as O,A as y,K as S,a as W,y as G}from"./index-CQ0pFaA9.js";import{u as b,C as H,B as J,D as V,H as _,P as T}from"./App-9vCfEsS0.js";import{p as k}from"./pdf-DFLGUOfR.js";import{a as z}from"./CheckFileValidation-BeJluwVf.js";const K=()=>e.jsx("div",{className:"loader",children:e.jsxs("div",{className:"wrapper",children:[e.jsx("div",{className:"circle"}),e.jsx("div",{className:"line-1"}),e.jsx("div",{className:"line-2"}),e.jsx("div",{className:"line-3"}),e.jsx("div",{className:"line-4"})]})}),ee=()=>{const[u,h]=a.useState(""),i=JSON.parse(sessionStorage.getItem("loggedInUser")),{response:r,sendApiRequest:w}=b(),{response:o,sendApiRequest:C}=b(),[c,m]=a.useState([]),[A,f]=a.useState(!1),g=a.useRef(null),x=a.useRef(null),R=U(),j=new URLSearchParams(R.search).get("id"),L=()=>{if(i){const s={TicketNo:j,AutoId:i.CustomerId,DeviceType:"Web",AppVersion:"1.0",LoginToken:i.LoginToken};w("POST","/GetSupportTicketDetail",s)}},v=()=>{if(i){const s={TicketNo:j,AutoId:i.CustomerId,DeviceType:"Web",AppVersion:"1.0",LoginToken:i.LoginToken};C("POST","/GetSupportTicketChatDetail",s)}},I=async()=>{try{if(f(!0),!c.length&&!u){O.fire({text:"Please Write Some Message!",icon:"warning"});return}const s=new FormData;if(Array.from(c).forEach(t=>s.append("File",t)),i){const t={TicketNo:j,Message:u,AutoId:i.CustomerId,DeviceType:"Web",AppVersion:"1.0",LoginToken:i.LoginToken,Attachments:""},l=await y.encryptString(S,JSON.stringify(t));s.append("Body",l);const n=await W.post("/SendAssociateSupportMessage",s,{headers:{"Content-Type":"multipart/form-data"}}),p=await y.decryptString(S,n.data.body),N=JSON.parse(p);N.Status===0?(v(),m([]),h("")):G.error(N.Message||"Error submitting ticket")}}catch(s){console.log(s)}finally{f(!1)}};a.useEffect(()=>{L()},[]),a.useEffect(()=>{v()},[]);const P=(s,t)=>s?s=="NA"?void 0:JSON.parse(s).map((n,p)=>e.jsx("div",{className:" d-flex",children:(n==null?void 0:n.FileType)==="PDF"?e.jsx("a",{target:"_blank",className:"",href:t+(n==null?void 0:n.FileName),children:e.jsx("img",{src:k,alt:"pdf icon"})}):e.jsx(T,{imgwithUrl:t+(n==null?void 0:n.FileName)})},p)):null,D=()=>c.length===0?null:Array.from(c).map((s,t)=>e.jsxs("div",{className:"position-relative renderFilePreview",style:{display:"inline-block",position:"relative"},children:[e.jsx("span",{className:"bg-danger px-2",style:{position:"absolute",right:"0%",top:"0%"},onClick:()=>q(t),children:"X"}),s.type.startsWith("image/")?e.jsx(T,{imgurl:s}):s.type==="application/pdf"?e.jsx("a",{href:URL.createObjectURL(s),target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:k,alt:"PDF preview",width:"100",className:"imgPreview",style:{aspectRatio:"1/1",objectFit:"contain",background:"#f5f5f5",padding:"10px",borderRadius:6}})},t):e.jsx("p",{style:{fontSize:"12px"},children:"Unsupported file"})]},t)),q=s=>{const t=Array.from(c).filter((l,n)=>n!==s);m(t)},M=s=>{const{id:t,value:l,files:n}=s.target;if(n){if(Array.from(n).some(p=>!z(p)))return;m(n)}},B=s=>{const{id:t,value:l,files:n}=s.target;h(l)};let d;o&&(d=[...o==null?void 0:o.SupportTicketChatData].reverse());const E=()=>{const t=x.current.scrollTop+x.current.clientHeight;return x.current.scrollHeight-t<100};return a.useLayoutEffect(()=>{var s;E()&&((s=g.current)==null||s.scrollIntoView())},[o,c]),e.jsx(H,{children:e.jsxs("div",{className:"scroll1111",ref:x,children:[e.jsx("div",{className:"chatheader position-sticky top-0 z-2",children:e.jsx("div",{className:"chatbox",children:e.jsxs("div",{className:"chatbox-top",children:[e.jsx("div",{className:"arrow-left",children:e.jsx(F,{to:"/my-profile",children:e.jsx(J,{size:30})})}),e.jsxs("div",{className:"got-questions",children:[e.jsx("h2",{children:"Chat Box"}),e.jsxs("span",{children:["Got questions? ",e.jsx("br",{}),"We’ve got answers...let’s chat!"]}),e.jsx("div",{})]})]})})}),e.jsx("div",{className:"chatbox ",children:e.jsxs("div",{className:"messaging",children:[e.jsxs("div",{className:"messaging-chat",children:[e.jsx("h3",{children:"Chat For:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Type:"}),e.jsx("span",{children:r==null?void 0:r.SupportType})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"For :"}),e.jsx("span",{children:r==null?void 0:r.SupportFor})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Subject :"}),e.jsx("span",{children:r==null?void 0:r.Subject})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Support Ticket Id:"}),e.jsx("span",{children:r==null?void 0:r.TicketNo})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Create at:"}),e.jsx("span",{children:r==null?void 0:r.CreateDate})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Last reply:"}),e.jsx("span",{children:r==null?void 0:r.LastUpdatedOn})]})]})]}),e.jsxs("div",{className:"chat-content  ",children:[e.jsx("div",{className:"message-overflow",children:e.jsxs("ul",{children:[(d==null?void 0:d.length)&&d.map((s,t)=>((s==null?void 0:s.Attachments)||(s==null?void 0:s.Message))&&e.jsx("li",{index:t,className:`  ${(s==null?void 0:s.MessageBy)==="Customer"?"messaging-right":void 0}`,children:e.jsxs("div",{className:"chat-right",children:[(s==null?void 0:s.Message)&&e.jsxs("div",{className:"chat-msg",children:[e.jsx("div",{className:"chat-profile-name",children:e.jsxs("h4",{children:[" ",s==null?void 0:s.MessageByName," "]})}),e.jsx("p",{children:s==null?void 0:s.Message})]}),(s==null?void 0:s.Attachments)&&e.jsx("div",{className:"d-flex column-gap-1 imgCont flex-wrap",children:P(s==null?void 0:s.Attachments,s==null?void 0:s.BASEURL)}),e.jsx("span",{children:s==null?void 0:s.CreatedDate})]})})),e.jsx("div",{className:"d-flex column-gap-1 imgCont flex-wrap justify-content-center",children:A?e.jsx(K,{}):D()}),e.jsx("div",{ref:g})]})}),e.jsx("div",{className:"row d-flex justify-content-center align-items-center me-0",children:e.jsxs("div",{className:"chat-footer  col-md-12 col-12",children:[e.jsx("label",{className:"input-group-text bg-white border-0",htmlFor:"file-upload",style:{cursor:"pointer"},children:e.jsx(V,{})}),e.jsx("textarea",{className:"form-control border-0 chat_form  onFocus",id:"Message",onChange:B,value:u}),e.jsx("div",{className:"form-buttons",children:e.jsxs("div",{className:"input-group border rounded-pill overflow-hidden",children:[e.jsx("input",{type:"file",id:"file-upload",hidden:!0,onChange:M,multiple:!0}),e.jsx("button",{className:"btn btn-light",onClick:I,children:e.jsx(_,{})})]})})]})})]})]})}),e.jsx("div",{className:"p-2",style:{maxHeight:"370px",overflowY:"scroll",scrollbarWidth:"thin"}}),o&&(o==null?void 0:o.SupportTicketChatData.length)>0&&e.jsx("div",{className:"p-2",style:{maxHeight:"370px",overflowY:"scroll",scrollbarWidth:"thin"}})]})})};export{ee as default};
